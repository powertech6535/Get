<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Token ä¸‹è½½é“¾æ¥ç”Ÿæˆå™¨</title>
<style>
  body{font-family:system-ui,Segoe UI,Arial;background:#041022;color:#eaf0ff;padding:28px;text-align:center}
  h1{color:#00e0ff}
  .card{max-width:720px;margin:14px auto;padding:18px;border-radius:12px;background:rgba(255,255,255,0.03)}
  input,select,button{padding:12px;border-radius:10px;border:none;font-size:16px}
  button.primary{background:#ff3b3b;color:#fff;padding:14px 26px;font-weight:700;border-radius:12px}
  button.ghost{background:#00c8d7;color:#000;margin-left:8px}
  pre{background:rgba(255,255,255,0.04);padding:12px;border-radius:8px;overflow:auto}
  .row{display:flex;gap:8px;align-items:center;justify-content:center}
</style>
</head>
<body>
  <h1>ğŸ” Token ä¸‹è½½ç”Ÿæˆå™¨ï¼ˆç®€æ˜“ï¼‰</h1>

  <div class="card">
    <div style="margin-bottom:10px">é€‰æ‹© Appï¼ˆå¯é€‰ï¼‰ï¼š</div>
    <select id="selectApp" style="width:70%;max-width:420px"></select>
    <div style="height:12px"></div>

    <div class="row" style="margin-bottom:12px">
      <button id="genToken" class="primary">ç”Ÿæˆ 5 ä½ Token</button>
      <button id="useToken" class="ghost">ç”¨ Token ç”Ÿæˆä¸‹è½½é“¾æ¥</button>
    </div>

    <div style="text-align:left;max-width:720px;margin:0 auto">
      <div>Tokenï¼š</div>
      <pre id="tokenOut">(å°šæœªç”Ÿæˆ)</pre>
      <div>ä¸‹è½½é“¾æ¥ï¼š</div>
      <pre id="linkOut">(å°šæœªç”Ÿæˆ)</pre>
    </div>

    <div style="margin-top:12px;color:#ffddcc;text-align:left;max-width:720px;margin-left:auto;margin-right:auto">
      æç¤ºï¼šç”Ÿæˆçš„ Token ä¼šç»‘å®šåˆ°å†…éƒ¨ uid å¹¶ä¿å­˜ 1 å¹´ã€‚Token å¯é€‰æ‹©æŒ‡å‘æŸä¸ª Appï¼ˆzoneï¼‰ï¼Œä¹Ÿå¯ä»¥åç”¨ Token æ—¶æŒ‡å®š zoneã€‚
    </div>
  </div>

<script>
const API_BASE = ""; // same origin (if hosted together). If Worker at app.powertech.workers.dev, set API_BASE = 'https://app.powertech.workers.dev'
const tokenOut = document.getElementById("tokenOut");
const linkOut = document.getElementById("linkOut");
const selectApp = document.getElementById("selectApp");

async function fetchApps() {
  try {
    const res = await fetch((API_BASE || "") + "/api/apps");
    const data = await res.json();
    const downloads = data.downloads || [];
    selectApp.innerHTML = `<option value="">ï¼ˆé»˜è®¤ zone=1ï¼‰</option>` + downloads.map(d => `<option value="${d.zone}">${d.name} (zone ${d.zone})</option>`).join("");
  } catch (err) {
    selectApp.innerHTML = `<option value="">æ— æ³•åŠ è½½ appsï¼ˆç¨åé‡è¯•ï¼‰</option>`;
  }
}
fetchApps();

document.getElementById("genToken").addEventListener("click", async () => {
  const zone = selectApp.value || undefined;
  try {
    const res = await fetch((API_BASE || "") + "/api/token", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(zone ? { zone } : {})
    });
    const data = await res.json();
    if (data.token) {
      tokenOut.textContent = data.token;
      linkOut.textContent = "(è¯·ç‚¹å‡»ã€Œç”¨ Token ç”Ÿæˆä¸‹è½½é“¾æ¥ã€)";
    } else {
      tokenOut.textContent = "ç”Ÿæˆå¤±è´¥: " + JSON.stringify(data);
    }
  } catch (err) {
    tokenOut.textContent = "é”™è¯¯: " + err.message;
  }
});

document.getElementById("useToken").addEventListener("click", async () => {
  const token = tokenOut.textContent.trim();
  if (!token || token.startsWith("(")) { alert("è¯·å…ˆç”Ÿæˆ Token"); return; }
  const zone = selectApp.value || undefined;
  try {
    const res = await fetch((API_BASE || "") + "/api/link", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(zone ? { token, zone } : { token })
    });
    const data = await res.json();
    if (data.link) {
      linkOut.innerHTML = data.link;
    } else {
      linkOut.textContent = "ç”Ÿæˆå¤±è´¥: " + JSON.stringify(data);
    }
  } catch (err) {
    linkOut.textContent = "é”™è¯¯: " + err.message;
  }
});
</script>
</body>
</html>
