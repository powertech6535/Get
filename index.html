<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=430, user-scalable=no">
<title>Token ç®¡ç†åå°</title>
<style>
  :root{
    --accent:#4d6aff;
    --bg1: #0a0f1c;
    --bg2: #02040a;
    --glass: rgba(255,255,255,0.06);
    --text: #eaf0ff;
  }
  html,body{height:100%;margin:0;padding:0;background:radial-gradient(circle at top, var(--bg1), var(--bg2));color:var(--text);font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
  /* container */
  .wrap{max-width:430px;margin:18px auto;padding:20px;box-sizing:border-box;}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));backdrop-filter: blur(10px);border-radius:14px;padding:18px;box-shadow:0 6px 30px rgba(0,0,0,0.5);}
  h1{font-size:20px;margin:4px 0 6px;text-align:center;color:#9ecbff;}
  .sub{font-size:13px;opacity:0.85;margin-bottom:12px;text-align:center;}

  label{display:block;margin-top:8px;color:#cfe6ff;font-size:14px;}
  input#uid{width:100%;padding:14px;border-radius:10px;border:none;background:rgba(255,255,255,0.04);color:var(--text);font-size:17px;box-sizing:border-box;margin-top:8px;}

  /* main button */
  button.main{
    width:100%;padding:14px;border-radius:12px;border:none;margin-top:14px;font-size:17px;background:linear-gradient(90deg,var(--accent),#89baff);color:#fff;cursor:pointer;font-weight:600;
  }

  /* app grid */
  .app-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:14px;}
  .app-btn{padding:12px;border-radius:10px;background:var(--glass);border:1px solid rgba(255,255,255,0.06);font-size:14px;text-align:center;cursor:pointer;transition:all .15s;}
  .app-btn:hover{transform:translateY(-3px);}
  .app-btn.active{background:linear-gradient(90deg,var(--accent),#6aa8ff);color:#fff;border-color:rgba(255,255,255,0.14);}

  /* result area */
  .result{margin-top:16px;padding:12px;border-radius:10px;background:rgba(0,0,0,0.35);display:none;}
  .result.success{border-left:4px solid #34d399;}
  .result.error{border-left:4px solid #ff6b6b;color:#ffd6d6;}

  .download-link{word-break:break-all;color:#bfe6ff;font-weight:600;margin-top:8px;}
  button.copy-big{margin-top:10px;padding:12px;width:100%;border-radius:10px;border:none;background:#10b981;color:#fff;font-size:16px;cursor:pointer;font-weight:600;}

  /* tutorial area */
  .tutorial-wrap{margin-top:18px;padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
  .t-head{display:flex;gap:8px;align-items:center;justify-content:space-between;}
  .t-tabs{display:flex;gap:8px;margin-top:10px;}
  .tab{padding:8px 10px;border-radius:8px;background:rgba(255,255,255,0.03);cursor:pointer;font-size:13px;}
  .tab.active{background:var(--accent);color:#fff}
  .lang-select{display:flex;gap:6px;}
  .lang-btn{padding:6px 8px;border-radius:7px;background:rgba(255,255,255,0.03);cursor:pointer;font-size:13px;}
  .lang-btn.active{background:#28c3ff;color:#001}

  #tutorialContent{margin-top:12px;color:#eaf0ff;font-size:14px;line-height:1.5;}
  #copyTutorial{margin-top:10px;padding:10px;border-radius:8px;border:none;background:#3d7cff;color:#fff;cursor:pointer;width:100%}

  /* hidden helper */
  .hidden{display:none !important;}

  /* mobile forced layout look */
  @media (max-width:800px){
    .wrap{padding:16px;}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ğŸ” Token ç®¡ç†ï¼ˆ5 ä½çŸ­ç ï¼‰</h1>
      <div class="sub">UID â†’ é€‰æ‹© APP â†’ ç”ŸæˆçŸ­é“¾ â†’ æŸ¥çœ‹æ•™ç¨‹ï¼ˆå¤šè¯­ï¼‰</div>

      <label for="uid">UIDï¼ˆå¿…å¡«ï¼‰</label>
      <input id="uid" placeholder="è¯·è¾“å…¥ UIDï¼Œä¾‹å¦‚ï¼šuser_123">

      <button class="main" id="generateBtn">ç”Ÿæˆå¹¶å†™å…¥ Token</button>

      <label style="margin-top:12px;">é€‰æ‹© APPï¼ˆè‡ªåŠ¨è½½å…¥ï¼‰</label>
      <div id="appGrid" class="app-grid">
        <div style="grid-column:1/3;text-align:center;opacity:0.8">åŠ è½½ä¸­â€¦</div>
      </div>

      <div id="msg" style="margin-top:10px;color:#ffdede"></div>

      <div id="resultBox" class="result" role="status">
        <div id="resultHint" style="font-weight:600"></div>
        <div id="downloadLink" class="download-link"></div>
        <button id="copyLinkBtn" class="copy-big hidden">ğŸ“‹ å¤åˆ¶ä¸‹è½½é“¾æ¥</button>
      </div>

      <!-- tutorialBox (è‡ªåŠ¨åˆ›å»ºå¹¶ç®¡ç†) -->
      <div id="tutorialBox" class="tutorial-wrap hidden" style="margin-top:16px;">
        <div class="t-head">
          <div style="font-weight:600">å®‰è£…æ•™ç¨‹</div>
          <div class="lang-select" aria-hidden="true">
            <div id="langZh" class="lang-btn active" onclick="setLanguage('zh')">ä¸­æ–‡</div>
            <div id="langEn" class="lang-btn" onclick="setLanguage('en')">EN</div>
            <div id="langMs" class="lang-btn" onclick="setLanguage('ms')">MS</div>
          </div>
        </div>

        <div class="t-tabs" style="margin-top:10px;">
          <div id="tabMobile" class="tab active" onclick="showTutorial('mobile')">æ‰‹æœº/å¹³æ¿</div>
          <div id="tabTvbox" class="tab" onclick="showTutorial('tvbox')">TV Box</div>
          <div id="tabAndroidTv" class="tab" onclick="showTutorial('androidtv')">Android TV</div>
        </div>

        <div id="tutorialContent" style="margin-top:12px;">
          <!-- åŠ¨æ€å¡«å……æ•™ç¨‹å†…å®¹ -->
          <i>è¯·å…ˆç”ŸæˆçŸ­é“¾æ¥åæŸ¥çœ‹æ•™ç¨‹ã€‚</i>
        </div>

        <button id="copyTutorial" onclick="copyTutorial()" class="hidden">å¤åˆ¶æ•™ç¨‹å†…å®¹</button>
      </div>

    </div>
  </div>
<script>
/ ç®€å• UUID ç”Ÿæˆï¼ˆä¿æŒåŒä¸€è®¾å¤‡ = åŒä¸€ä¸ª x-device-idï¼‰
function getDeviceId() {
  let id = localStorage.getItem("x-device-id");
  if (!id) {
    id = crypto.randomUUID();
    localStorage.setItem("x-device-id", id);
  }
  return id;
}
</script>
<script>
/* ============================
   CONFIG / STATE
   ============================ */
const API = "https://app.powertech.workers.dev";
let apps = [];            // array of {name, url}
let selectedFile = "";    // selected file name (url)
let selectedAppName = ""; // app display name
let lastShort = "";       // last generated short code
let lastDownloadUrl = ""; // last download full url
let currentLang = "zh";   // zh | en | ms
let currentType = "mobile"; // mobile | tvbox | androidtv
let generating = false;

/* ============================
   UI HELPERS
   ============================ */
function el(q){ return document.querySelector(q); }
function showMsg(text, color="#ffdede"){ const m=el("#msg"); m.style.color=color; m.textContent = text; }
function showResult(ok, link){
  const box = el("#resultBox");
  const hint = el("#resultHint");
  const linkEl = el("#downloadLink");
  const copyBtn = el("#copyLinkBtn");

  box.style.display = ok ? "block" : "block";
  box.className = ok ? "result success" : "result error";
  hint.textContent = ok ? "å†™å…¥æˆåŠŸï¼" : "å†™å…¥å¤±è´¥";
  linkEl.innerHTML = ok ? `<a href="${link}" target="_blank" style="color:#cfeeff">${link}</a>` : (link || "");
  if(ok){ copyBtn.classList.remove("hidden"); } else { copyBtn.classList.add("hidden"); }
}

/* ============================
   LOAD APPS FROM R2 & RENDER
   ============================ */
async function loadApps(){
  const grid = el("#appGrid");
  grid.innerHTML = `<div style="grid-column:1/3;text-align:center;opacity:0.8">åŠ è½½ä¸­â€¦</div>`;
  try{
    const res = await fetch(`${API}/r2/downloads.json`);
    if(!res.ok) throw new Error("çŠ¶æ€ " + res.status);
    const data = await res.json();
    apps = Array.isArray(data.downloads) ? data.downloads.slice() : [];
    if(apps.length === 0){
      grid.innerHTML = `<div style="grid-column:1/3;text-align:center;opacity:0.8">(æ— å¯ç”¨ APP)</div>`;
      return;
    }
    grid.innerHTML = "";
    apps.forEach((it, idx) => {
      const d = document.createElement("div");
      d.className = "app-btn";
      d.textContent = it.name;
      d.title = it.url;
      d.onclick = () => {
        document.querySelectorAll(".app-btn").forEach(b=>b.classList.remove("active"));
        d.classList.add("active");
        selectedFile = it.url;
        selectedAppName = it.name;
      };
      // auto select first
      if(idx===0){
        d.classList.add("active");
        selectedFile = it.url;
        selectedAppName = it.name;
      }
      grid.appendChild(d);
    });
  }catch(e){
    grid.innerHTML = `<div style="grid-column:1/3;text-align:center;color:#ffb3b3">åŠ è½½å¤±è´¥</div>`;
    console.error("loadApps error", e);
  }
}

/* ============================
   CREATE TOKEN
   POST /api/create-token  (payload: { uid, file })
   Response: { ok:true, short, downloadUrl }
   ============================ */
el("#generateBtn").addEventListener("click", async (ev) => {
  if (generating) return;
  generating = true;

  const uid = (el("#uid").value || "").trim();
  showMsg("");
  if(!uid){ showMsg("è¯·è¾“å…¥ UID"); generating=false; return; }
  if(!selectedFile){ showMsg("è¯·é€‰æ‹© APP"); generating=false; return; }

  try{
    // call API
    const resp = await fetch(`${API}/api/create-token`, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ uid, file: selectedFile })
    });

    let data;
    try { data = await resp.json(); } catch { data = null; }

    if(!resp.ok || !data || (!data.short && !data.ok)){
      const errTxt = (data && data.error) ? data.error : `HTTP ${resp.status}`;
      showMsg("å†™å…¥å¤±è´¥ï¼š" + errTxt, "#ffb3b3");
      showResult(false, errTxt);
      generating = false;
      return;
    }

    // normalize: some versions return { short } or { ok:true, short }
    const short = data.short || data.code || (data.ok && data.short) || null;
    const downloadUrl = data.downloadUrl || (short ? `${API}/${short}` : null);

    lastShort = short;
    lastDownloadUrl = downloadUrl || "";

    showMsg("å†™å…¥æˆåŠŸï¼", "#bfffcf");
    showResult(true, lastDownloadUrl);

    // show copy link handler
    el("#copyLinkBtn").onclick = () => {
      if(!lastDownloadUrl) return;
      navigator.clipboard.writeText(lastDownloadUrl).then(()=> alert("ä¸‹è½½é“¾æ¥å·²å¤åˆ¶"));
    };

    // show tutorial area & auto scroll -> mobile
    el("#tutorialBox").classList.remove("hidden");
    // ensure language button UI reflect currentLang
    document.querySelectorAll(".lang-btn").forEach(b => b.classList.remove("active"));
    el(currentLang === "zh" ? "#langZh" : currentLang === "en" ? "#langEn" : "#langMs").classList.add("active");

    // auto open mobile tutorial
    showTutorial("mobile");
    // smooth scroll into view
    document.getElementById("tutorialBox").scrollIntoView({ behavior: "smooth" });

  }catch(err){
    console.error("create token error", err);
    showMsg("âŒ ç”ŸæˆçŸ­é“¾æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚", "#ffb3b3");
    showResult(false, "ç½‘ç»œé”™è¯¯");
  } finally { generating = false; }
});

/* ============================
   LANGUAGE & TUTORIAL SYSTEM
   ============================ */
function setLanguage(lang){
  currentLang = lang;
  // UI
  document.querySelectorAll(".lang-btn").forEach(b=>b.classList.remove("active"));
  if(lang==="zh") el("#langZh").classList.add("active");
  if(lang==="en") el("#langEn").classList.add("active");
  if(lang==="ms") el("#langMs").classList.add("active");
  showTutorial(currentType);
}

function showTutorial(type){
  currentType = type;
  // tabs UI
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  if(type==="mobile") el("#tabMobile").classList.add("active");
  if(type==="tvbox") el("#tabTvbox").classList.add("active");
  if(type==="androidtv") el("#tabAndroidTv").classList.add("active");

  const tutorial = el("#tutorialContent");
  const copyBtn = el("#copyTutorial");

  if(!lastDownloadUrl || !selectedAppName){
    tutorial.innerHTML = "<i>è¯·å…ˆç”ŸæˆçŸ­é“¾æ¥åæŸ¥çœ‹æ•™ç¨‹ã€‚</i>";
    copyBtn.classList.add("hidden");
    return;
  }

  // warnings
  const warn = {
    zh: "âš ï¸ è¯·ä½¿ç”¨ç›¸å¯¹åº”çš„è®¾å¤‡è¾“å…¥ä¸‹è½½é“¾æ¥ï¼Œä¸è¦ç”¨å…¶ä»–è®¾å¤‡æ‰“å¼€ï¼åŒæ ·è®¾å¤‡æ²¡æœ‰é™åˆ¶è®¿é—®ã€‚ğŸš«åˆ«åœ¨è¿™é‡Œç‚¹å‡»ä¸‹è½½é“¾æ¥",
    en: "âš ï¸ Please use the correct device to open the download link. The same device has no access limit.ğŸš«Do not click the download link here.",
    ms: "âš ï¸ Sila gunakan peranti yang betul untuk membuka pautan muat turun. Peranti yang sama tidak mempunyai had akses.ğŸš«Jangan klik pautan muat turun di sini."
  };

  // texts per language & type
  const texts = {
    zh: {
      mobile: `
<h3>ğŸ“± æ‰‹æœº/å¹³æ¿ç‰ˆå®‰è£…æ•™ç¨‹</h3>
1ï¸âƒ£ æŠ„å†™â€œä¸‹è½½é“¾æ¥â€å¹¶å¤åˆ¶ã€‚<br>
2ï¸âƒ£ æ‰“å¼€ <b>Google Chrome</b> æµè§ˆå™¨ã€‚<br>
3ï¸âƒ£ ç²˜è´´é“¾æ¥å¹¶æ‰“å¼€ï¼Œä¸‹è½½å®‰è£… <b>${selectedAppName}</b>ã€‚<br><br>
ğŸ’¡ <b>æç¤ºï¼š</b> æ¯ä¸ªä¸‹è½½é“¾æ¥æœ€å¤šæ”¯æŒ <b>3 å°è®¾å¤‡</b> ä½¿ç”¨ï¼Œè¶…è¿‡ 3 å°è®¾å¤‡è®¿é—®åï¼Œé“¾æ¥ä¼š <b>è‡ªåŠ¨å¤±æ•ˆ</b>ã€‚<br>
âš ï¸ <b>è¯·ä½¿ç”¨å¯¹åº”çš„è®¾å¤‡è¾“å…¥ä¸‹è½½é“¾æ¥ï¼Œä¸è¦è®©å…¶ä»–è®¾å¤‡æ‰“å¼€ï¼</b><br>
ğŸ‘‰ <b>åŒä¸€å°è®¾å¤‡å¤šæ¬¡ä½¿ç”¨ä¸å—é™åˆ¶ã€‚</b><br>
ğŸš« <b>ä¸è¦åœ¨æ­¤é¡µé¢ç›´æ¥ç‚¹å‡»ä¸‹è½½é“¾æ¥ï¼</b><br><br>
ğŸ”— ä¸‹è½½é“¾æ¥ï¼š<h3><a href="${lastDownloadUrl}" target="_blank">${lastDownloadUrl}</a></h3>
`,

      tvbox: `
<h3>ğŸ“º TV Box / æŠ•å½±ä»ª å®‰è£…æ•™ç¨‹</h3>
1ï¸âƒ£ æŠ„å†™å¹¶å¤åˆ¶æ‚¨çš„ <b>ä¸‹è½½é“¾æ¥</b>ã€‚<br>
2ï¸âƒ£ æ‰“å¼€ <b>Google Chrome</b> æµè§ˆå™¨ã€‚<br>
3ï¸âƒ£ ç²˜è´´é“¾æ¥å¹¶æ‰“å¼€é¡µé¢ï¼Œä¸‹è½½å®‰è£… <b>${selectedAppName}</b>ã€‚<br><br>
ğŸ’¡ <b>æç¤ºï¼š</b> æ¯ä¸ªä¸‹è½½é“¾æ¥æœ€å¤šæ”¯æŒ <b>3 å°è®¾å¤‡</b> ä½¿ç”¨ï¼Œè¶…è¿‡ 3 å°è®¾å¤‡è®¿é—®åï¼Œé“¾æ¥ä¼š <b>è‡ªåŠ¨å¤±æ•ˆ</b>ã€‚<br>
âš ï¸ <b>è¯·ä½¿ç”¨å¯¹åº”çš„è®¾å¤‡è¾“å…¥ä¸‹è½½é“¾æ¥ï¼Œä¸è¦è®©å…¶ä»–è®¾å¤‡æ‰“å¼€ï¼</b><br>
ğŸ‘‰ <b>åŒä¸€å°è®¾å¤‡å¤šæ¬¡ä½¿ç”¨ä¸å—é™åˆ¶ã€‚</b><br>
ğŸš« <b>ä¸è¦åœ¨æ­¤é¡µé¢ç›´æ¥ç‚¹å‡»ä¸‹è½½é“¾æ¥ï¼</b><br><br>
ğŸ”— ä¸‹è½½é“¾æ¥ï¼š<br><h3><a href="${lastDownloadUrl}" target="_blank">${lastDownloadUrl}</a></h3>
`,

      androidtv: `
<h3>ğŸ“º Android TV / Google TV å®‰è£…æ•™ç¨‹</h3>
1ï¸âƒ£ æ‰“å¼€ <b>Google Play å•†åº—</b>ã€‚<br>
2ï¸âƒ£ æœç´¢å¹¶å®‰è£… <b>Downloader (AFT)</b>ã€‚<br>
3ï¸âƒ£ æ‰“å¼€ <b>Downloader (AFT)</b>ï¼Œç²˜è´´çŸ­é“¾æ¥å¹¶ç‚¹å‡»â€œGoâ€ã€‚<br>
4ï¸âƒ£ ä¸‹è½½å®Œæˆåé€‰æ‹©â€œå®‰è£…â€ <b>${selectedAppName}</b>ã€‚<br><br>
ğŸ’¡ <b>æç¤ºï¼š</b> æ¯ä¸ªä¸‹è½½é“¾æ¥æœ€å¤šæ”¯æŒ <b>3 å°è®¾å¤‡</b>ï¼Œè¶…è¿‡åä¼šè‡ªåŠ¨å¤±æ•ˆã€‚<br>
âš ï¸ <b>è¯·ä½¿ç”¨æ­£ç¡®è®¾å¤‡è¾“å…¥ä¸‹è½½é“¾æ¥ï¼</b><br>
ğŸ‘‰ <b>åŒä¸€è®¾å¤‡æ— é™åˆ¶ã€‚</b><br>
ğŸš« <b>ä¸è¦åœ¨æ­¤é¡µé¢ç‚¹å‡»ä¸‹è½½é“¾æ¥ï¼</b><br><br>
ğŸ”— ä¸‹è½½é“¾æ¥ï¼š<h3><a href="${lastDownloadUrl}" target="_blank">${lastDownloadUrl}</a></h3>
`
    },

    en: {
      mobile: `
<h3>ğŸ“± Mobile / Tablet Installation</h3>
1ï¸âƒ£ Copy the download link.<br>
2ï¸âƒ£ Open <b>Google Chrome</b> browser.<br>
3ï¸âƒ£ Paste the link to download and install <b>${selectedAppName}</b>.<br><br>
ğŸ’¡ Note: Each link supports <b>3 devices</b>. Beyond that, it expires.<br>
${warn.en}<br><br>
ğŸ”— Link: <h3><a href="${lastDownloadUrl}" target="_blank">${lastDownloadUrl}</a></h3>
`,

      tvbox: `
<h3>ğŸ“º TV Box / Projector Installation</h3>
1ï¸âƒ£ Copy your <b>download link</b>.<br>
2ï¸âƒ£ Open <b>Google Chrome</b> browser.<br>
3ï¸âƒ£ Paste the link to download and install <b>${selectedAppName}</b>.<br><br>
ğŸ’¡ Note: Each download link supports <b>3 different devices</b> before expiring.<br>
âš ï¸ Please use the correct device.<br>
ğŸ‘‰ Same device = unlimited usage.<br>
ğŸš« Do NOT click the link here!<br><br>
ğŸ”— Link: <h3><a href="${lastDownloadUrl}" target="_blank">${lastDownloadUrl}</a></h3>
`,

      androidtv: `
<h3>ğŸ“º Android TV / Google TV Installation</h3>
1ï¸âƒ£ Open <b>Google Play Store</b>.<br>
2ï¸âƒ£ Install <b>Downloader (AFT)</b>.<br>
3ï¸âƒ£ Open Downloader and enter the link.<br>
4ï¸âƒ£ Install <b>${selectedAppName}</b>.<br><br>
ğŸ’¡ Note: Max 3 devices.<br>
${warn.en}<br><br>
ğŸ”— Link: <h3><a href="${lastDownloadUrl}" target="_blank">${lastDownloadUrl}</a></h3>
`
    },

    ms: {
      mobile: `
<h3>ğŸ“± Pemasangan Telefon / Tablet</h3>
1ï¸âƒ£ Salin pautan muat turun.<br>
2ï¸âƒ£ Buka pelayar <b>Google Chrome</b>.<br>
3ï¸âƒ£ Tampal pautan untuk muat turun aplikasi <b>${selectedAppName}</b>.<br><br>
ğŸ’¡ Nota: Maksimum <b>3 peranti</b> sahaja.<br>
${warn.ms}<br><br>
ğŸ”— Pautan: <h3><a href="${lastDownloadUrl}" target="_blank">${lastDownloadUrl}</a></h3>
`,

      tvbox: `
<h3>ğŸ“º Pemasangan TV Box / Projektor</h3>
1ï¸âƒ£ Salin pautan muat turun anda.<br>
2ï¸âƒ£ Buka pelayar <b>Google Chrome</b>.<br>
3ï¸âƒ£ Tampal dan buka pautan untuk memasang <b>${selectedAppName}</b>.<br><br>
ğŸ’¡ Perhatian: Setiap pautan hanya untuk <b>3 peranti berlainan</b>.<br>
âš ï¸ Guna peranti yang betul.<br><br>
ğŸ”— Pautan: <h3><a href="${lastDownloadUrl}" target="_blank">${lastDownloadUrl}</a></h3>
`,

      androidtv: `
<h3>ğŸ“º Versi Android TV / Google TV</h3>
1ï¸âƒ£ Buka <b>Google Play Store</b>.<br>
2ï¸âƒ£ Pasang aplikasi <b>Downloader (AFT)</b>.<br>
3ï¸âƒ£ Tampal pautan pendek dan tekan "Go".<br>
4ï¸âƒ£ Pasang <b>${selectedAppName}</b>.<br><br>
ğŸ’¡ Nota: 3 peranti maksimum.<br>
${warn.ms}<br><br>
ğŸ”— Pautan: <h3><a href="${lastDownloadUrl}" target="_blank">${lastDownloadUrl}</a></h3>
`
    }
  };

  // fill tutorial content
  tutorial.innerHTML = (texts[currentLang] && texts[currentLang][type]) ? texts[currentLang][type] : "<i>æ•™ç¨‹ä¸å¯ç”¨</i>";
  copyBtn.classList.remove("hidden");
}

/* copy tutorial content as plain text */
function copyTutorial(){
  const tutorial = document.getElementById("tutorialContent");
  const text = tutorial.innerText || tutorial.textContent || "";
  navigator.clipboard.writeText(text).then(()=> alert("æ•™ç¨‹å·²å¤åˆ¶"));
}

/* ============================
   on load
   ============================ */
document.addEventListener("DOMContentLoaded", ()=> {
  loadApps();
  // set initial lang/tab UI
  setLanguage(currentLang);
  showTutorial(currentType);
});

// expose setLanguage/showTutorial to inline onclicks
window.setLanguage = setLanguage;
window.showTutorial = showTutorial;
window.copyTutorial = copyTutorial;
</script>
</body>
</html>

