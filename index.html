<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Token ç”Ÿæˆå™¨ï¼ˆ5ä½æ•°å­—ï¼‰</title>
<style>
  body{font-family:system-ui,Segoe UI,Roboto; background:#081025;color:#eaf0ff;padding:20px}
  .card{max-width:720px;margin:18px auto;padding:18px;border-radius:12px;background:rgba(255,255,255,0.02)}
  label{display:block;margin-top:10px;font-weight:600}
  input,select,button{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
  .row{display:flex;gap:10px}
  .small{width:160px}
  button{background:#3c8bff;color:white;border:none;cursor:pointer;margin-top:12px}
  pre{background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;margin-top:12px;white-space:pre-wrap}
</style>
</head>
<body>
<div class="card">
  <h2>ğŸ” Token ç®¡ç†ï¼ˆ5 ä½æ•°å­—ï¼‰</h2>
  <p>æ‰‹åŠ¨è¾“å…¥ UIDï¼Œå¹¶é€‰æ‹©è¦å†™å…¥çš„ APKï¼ˆfile å­—æ®µï¼‰ã€‚</p>

  <label>UIDï¼ˆå¿…å¡«ï¼‰</label>
  <input id="uid" placeholder="ä¾‹å¦‚ user_123" />

  <label>é€‰æ‹© APPï¼ˆfileï¼‰</label>
  <select id="fileSelect"><option>åŠ è½½ä¸­...</option></select>

  <div style="margin-top:12px">
    <button id="gen">ç”Ÿæˆå¹¶å†™å…¥ TOKENS KV</button>
  </div>

  <pre id="result">â€”</pre>

  <p style="font-size:13px;color:#9fb0d6;margin-top:8px">æ³¨æ„ï¼šæ­¤é¡µé¢ç›´æ¥è¯·æ±‚ä½ çš„ Workerï¼ˆ/api/create-tokenï¼‰ï¼Œä¸ä¼šæ³„éœ² Cloudflare ç®¡ç† Tokenã€‚</p>
</div>

<script>
const WORKER_BASE = "https://app.powertech.workers.dev";

async function loadDownloads(){
  try{
    const res = await fetch(WORKER_BASE + "/api/downloads");
    const j = await res.json();
    const sel = document.getElementById('fileSelect');
    sel.innerHTML = "";
    if (!j || !j.downloads) {
      sel.innerHTML = "<option value='app.apk'>app.apk</option>";
      return;
    }
    j.downloads.forEach(d=> {
      const opt = document.createElement('option');
      opt.value = d.url;
      opt.textContent = `${d.name} â€” ${d.url}`;
      sel.appendChild(opt);
    });
  } catch(e) {
    const sel = document.getElementById('fileSelect');
    sel.innerHTML = "<option value='app.apk'>app.apk</option>";
  }
}

async function createToken(){
  const uid = document.getElementById('uid').value.trim();
  const file = document.getElementById('fileSelect').value;
  if (!uid) { alert('è¯·è¾“å…¥ UID'); return; }
  if (!file) { alert('è¯·é€‰æ‹© file'); return; }

  document.getElementById('result').textContent = 'â³ ç”Ÿæˆå¹¶å†™å…¥ä¸­...';

  try {
    const res = await fetch(WORKER_BASE + "/api/create-token", {
      method: "POST",
      headers: {
        "Content-Type":"application/json"
      },
      body: JSON.stringify({ uid, file })
    });
    const json = await res.json().catch(()=>null);
    if (!res.ok) {
      document.getElementById('result').textContent = 'å†™å…¥å¤±è´¥: ' + (json ? JSON.stringify(json) : res.statusText);
      return;
    }
    const out = `âœ… å†™å…¥æˆåŠŸ\nçŸ­ç : ${json.short}\nä¸‹è½½é“¾æ¥: ${json.downloadUrl}\n\nKV å€¼: {"uid":"${uid}","file":"${file}"}`;
    document.getElementById('result').textContent = out;
  } catch(e) {
    document.getElementById('result').textContent = 'ç½‘ç»œæˆ–ç¨‹åºé”™è¯¯: ' + e.message;
  }
}

document.getElementById('gen').onclick = createToken;
loadDownloads();
</script>
</body>
</html>
