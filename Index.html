<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>APPä¸‹è½½é“¾æ¥ç”Ÿæˆå™¨ â€” Token ç‰ˆ</title>
<style>
  /* ç®€åŒ–æ ·å¼ï¼Œä¿ç•™ä¹‹å‰è§†è§‰æ„Ÿ */
  body{font-family:system-ui;padding:24px;background:radial-gradient(circle at top,#0a0f1c,#02040a);color:#eaf0ff}
  h1{color:#00e0ff}
  .btn-versions{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;max-width:720px}
  .version-btn{background:#00e0ff;color:#000;border-radius:10px;padding:12px;border:none;font-weight:700;cursor:pointer}
  #generate{background:#ff3b3b;padding:14px 28px;border-radius:14px;border:none;font-size:1.1rem;cursor:pointer}
  pre{background:rgba(255,255,255,0.06);padding:12px;border-radius:10px;white-space:pre-wrap}
  .tutorial{background:rgba(255,255,255,0.04);padding:16px;border-radius:12px;margin-top:18px;max-width:760px}
  .lang-buttons button{margin-right:8px;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
</style>
</head>
<body>
  <h1>APP ä¸‹è½½é“¾æ¥ç”Ÿæˆå™¨ï¼ˆToken ç‰ˆï¼‰</h1>

  <label>UIDï¼ˆå¯é€‰ â€” ä¸å½±å“ Token æµç¨‹ï¼‰</label><br>
  <input id="uid" placeholder="ä¾‹å¦‚ user123" style="padding:10px;border-radius:8px;border:none;width:80%;max-width:320px"><br><br>

  <h3>è¯·é€‰æ‹©ç‰ˆæœ¬ï¼ˆzoneï¼‰</h3>
  <div class="btn-versions" id="versionContainer"></div>

  <div style="margin-top:18px">
    <button id="generate">âš™ï¸ ç”ŸæˆçŸ­é“¾ï¼ˆTokenï¼‰</button>
    <button id="copyBtn" style="display:none;margin-left:8px">ğŸ“‹ å¤åˆ¶çŸ­é“¾</button>
  </div>

  <pre id="output">ğŸ‘‰ é€‰æ‹©ç‰ˆæœ¬ç„¶åç‚¹å‡»â€œç”ŸæˆçŸ­é“¾ï¼ˆTokenï¼‰â€</pre>

  <div class="tutorial">
    <h3>ğŸ“˜ å®‰è£…æ•™ç¨‹</h3>
    <div class="lang-buttons">
      <button onclick="setLanguage('zh')">ä¸­æ–‡</button>
      <button onclick="setLanguage('en')">English</button>
      <button onclick="setLanguage('ms')">Bahasa</button>
    </div>
    <div style="margin-top:10px">
      <button onclick="showTutorial('mobile')">ğŸ“± æ‰‹æœº</button>
      <button onclick="showTutorial('tvbox')">ğŸ“º TV Box</button>
      <button onclick="showTutorial('androidtv')">ğŸ“º Android TV</button>
    </div>
    <div id="tutorialContent" style="margin-top:12px"></div>
  </div>

<script>
const workerApi = "https://app.powertech.workers.dev"; // YOUR worker domain
const r2Base = "https://app.powertech.workers.dev"; // used only for short link display
const jsonURL = "https://raw.githubusercontent.com/PowerTech0417/LinksApp_worker/refs/heads/main/downloads.json";

let selectedZone = null;
let appName = "";
let token = null;
let currentLang = "zh";
let currentType = "mobile";

async function loadVersions(){
  const res = await fetch(jsonURL);
  const data = await res.json();
  const container = document.getElementById("versionContainer");
  container.innerHTML = "";
  // support array format or map format
  if (Array.isArray(data.downloads)){
    data.downloads.forEach(d=>{
      const btn = document.createElement("button");
      btn.className = "version-btn";
      btn.textContent = d.name + " (z"+d.zone+")";
      btn.dataset.zone = d.zone;
      btn.addEventListener("click", ()=>{ document.querySelectorAll(".version-btn").forEach(b=>b.style.transform=""); btn.style.transform="scale(1.04)"; selectedZone=d.zone; appName=d.name; document.getElementById("output").textContent = `å·²é€‰æ‹© ${d.name} (zone ${d.zone})`; });
      container.appendChild(btn);
    });
  } else {
    // map format
    Object.keys(data).forEach(k=>{
      const btn = document.createElement("button");
      btn.className = "version-btn";
      btn.textContent = "Zone "+k;
      btn.dataset.zone = k;
      btn.addEventListener("click", ()=>{ document.querySelectorAll(".version-btn").forEach(b=>b.style.transform=""); btn.style.transform="scale(1.04)"; selectedZone=k; appName="Zone "+k; document.getElementById("output").textContent = `å·²é€‰æ‹© Zone ${k}`; });
      container.appendChild(btn);
    });
  }
}
loadVersions();

document.getElementById("generate").addEventListener("click", async ()=>{
  if (!selectedZone) return alert("è¯·é€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬ (zone)");
  document.getElementById("output").textContent = "â³ æ­£åœ¨ç”Ÿæˆ Token...";
  try {
    const res = await fetch(`${workerApi}/api/new-token?zone=${selectedZone}`);
    const data = await res.json();
    token = data.token;
    const shortURL = `${workerApi}/t/${token}`;
    document.getElementById("output").innerHTML = `âœ… Token: <b>${token}</b>\nçŸ­é“¾: <a href="${shortURL}" target="_blank">${shortURL}</a>`;
    const cb = document.getElementById("copyBtn");
    cb.style.display = "inline-block";
    cb.onclick = ()=>{ navigator.clipboard.writeText(shortURL); cb.textContent="âœ… å·²å¤åˆ¶"; setTimeout(()=>cb.textContent="ğŸ“‹ å¤åˆ¶çŸ­é“¾",1600); };
    // è‡ªåŠ¨å±•å¼€æ•™ç¨‹
    showTutorial('mobile');
    document.querySelector('.tutorial').scrollIntoView({behavior:'smooth'});
  } catch (e) {
    document.getElementById("output").textContent = "âŒ ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";
  }
});

function setLanguage(l){ currentLang = l; showTutorial(currentType); }

function showTutorial(type){
  currentType = type;
  const t = document.getElementById("tutorialContent");
  if (!token) { t.innerHTML = "<i>è¯·å…ˆç”Ÿæˆ Token å¹¶å¤åˆ¶çŸ­é“¾åæŸ¥çœ‹æ•™ç¨‹ã€‚</i>"; return; }
  const link = `${workerApi}/t/${token}`;
  const warn = {
    zh: "âš ï¸ è¯·ä½¿ç”¨ç›¸å¯¹åº”çš„è®¾å¤‡è¾“å…¥ä¸‹è½½é“¾æ¥ï¼Œä¸è¦ç”¨å…¶ä»–è®¾å¤‡æ‰“å¼€ï¼åŒæ ·è®¾å¤‡æ²¡æœ‰é™åˆ¶è®¿é—®ã€‚ä¸è¦åœ¨æ­¤é¡µé¢ç›´æ¥ç‚¹å‡»ä¸‹è½½é“¾æ¥ã€‚",
    en: "âš ï¸ Please use the correct device to open the download link. Same device has no access limit. Do NOT click the link here.",
    ms: "âš ï¸ Sila gunakan peranti yang betul untuk membuka pautan muat turun. Peranti sama tidak mempunyai had akses. Jangan klik pautan di sini."
  };
  const name = appName || "APP";
  const templates = {
    zh: {
      mobile: `<h4>ğŸ“± æ‰‹æœº/å¹³æ¿å®‰è£…</h4>1ï¸âƒ£ å¤åˆ¶ä¸‹è½½çŸ­é“¾å¹¶åœ¨ç›®æ ‡è®¾å¤‡ä¸Šæ‰“å¼€ã€‚ <br>2ï¸âƒ£ ä½¿ç”¨ Chrome æ‰“å¼€å¹¶ä¸‹è½½å®‰è£… <b>${name}</b>ã€‚<br><br>ğŸ’¡ æç¤ºï¼šæ¯ä¸ªçŸ­é“¾æœ€å¤šæ”¯æŒ 3 å°ä¸åŒè®¾å¤‡ã€‚<br>${warn.zh}<br><br>ğŸ”— çŸ­é“¾ï¼š<a href="${link}" target="_blank">${link}</a>`,
      tvbox: `<h4>ğŸ“º TV Box / æŠ•å½± å®‰è£…</h4>åŒä¸Šã€‚<br><br>ğŸ”— çŸ­é“¾ï¼š<a href="${link}" target="_blank">${link}</a>`,
      androidtv: `<h4>ğŸ“º Android TV / Google TV</h4>1ï¸âƒ£ åœ¨ Play å•†åº—å®‰è£… Downloader (AFT)ã€‚<br>2ï¸âƒ£ åœ¨ Downloader ç²˜è´´çŸ­é“¾å¹¶ Goã€‚<br>3ï¸âƒ£ ä¸‹è½½å®Œæˆåå®‰è£… <b>${name}</b>ã€‚<br><br>${warn.zh}<br><br>ğŸ”— çŸ­é“¾ï¼š<a href="${link}" target="_blank">${link}</a>`
    },
    en: {
      mobile: `<h4>ğŸ“± Mobile / Tablet</h4>Copy the short link and open it on the target device (Chrome).<br>Install <b>${name}</b>.<br><br>${warn.en}<br><br>Link: <a href="${link}" target="_blank">${link}</a>`,
      tvbox: `<h4>ğŸ“º TV Box / Projector</h4>Same steps.<br><br>Link: <a href="${link}" target="_blank">${link}</a>`,
      androidtv: `<h4>ğŸ“º Android TV / Google TV</h4>1) Install Downloader (AFT) from Play Store.<br>2) Paste short link in Downloader and Go.<br>3) Install <b>${name}</b>.<br><br>${warn.en}<br><br>Link: <a href="${link}" target="_blank">${link}</a>`
    },
    ms: {
      mobile: `<h4>ğŸ“± Telefon / Tablet</h4>Salin pautan dan buka pada peranti sasaran (Chrome).<br>Pasang <b>${name}</b>.<br><br>${warn.ms}<br><br>Pautan: <a href="${link}" target="_blank">${link}</a>`,
      tvbox: `<h4>ğŸ“º TV Box / Projektor</h4>Sama seperti di atas.<br><br>Pautan: <a href="${link}" target="_blank">${link}</a>`,
      androidtv: `<h4>ğŸ“º Android TV / Google TV</h4>1) Pasang Downloader (AFT) dari Play Store.<br>2) Tampal pautan dalam Downloader dan Go.<br>3) Pasang <b>${name}</b>.<br><br>${warn.ms}<br><br>Pautan: <a href="${link}" target="_blank">${link}</a>`
    }
  };
  t.innerHTML = templates[currentLang][type];
}
</script>
</body>
</html>
